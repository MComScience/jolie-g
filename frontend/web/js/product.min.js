"use strict";var $elmqrcode=$("#tbproduct-qrcode"),$elmqrcode_qty=$("#tbproduct-qrcode_qty"),$elmcount=$("#count-qrcode"),$form=$("#form-product"),$keys=[],product={isEmpty:function(e){return void 0===e||null===e||0===e.length},setCount:function(){var e=$elmqrcode.tagsinput("items").length;$elmcount.html(e),$elmqrcode_qty.val(e)}};$("button.on-gen-qrcode").on("click",function(e){e.preventDefault();var t=$elmqrcode_qty.val();if(product.isEmpty(t))return swal({type:"warning",title:"Oops...",text:"กรุณากรอกจำนวน"}),!1;$elmqrcode.tagsinput("removeAll");for(var o=0;o<t;o++)$elmqrcode.tagsinput("add",{value:Math.floor(899999999998*Math.random())+100000000001,text:Math.floor(899999999998*Math.random())+100000000001,continent:"success"})}),$("button.on-clear").on("click",function(e){$elmqrcode.tagsinput("removeAll"),product.setCount()}),$elmqrcode.on("itemAdded",function(){product.setCount()}),$elmqrcode.on("itemRemoved",function(){product.setCount()}),$form.on("beforeSubmit",function(){var e=$form.serialize();return $.ajax({url:$form.attr("action"),type:$form.attr("method"),data:e,success:function(e){e.success?(swal({type:"success",title:e.message,showConfirmButton:!1,timer:2e3}),setTimeout(function(){window.location.href=e.url},2e3)):($.each(e.validate,function(e,t){$($form).yiiActiveForm("updateAttribute",e,[t])}),$("html, body").animate({scrollTop:0},"slow"))},error:function(e,t){swal({type:"error",title:"Oops...",text:t})}}),!1}),$("table#tb-qrcode tbody").on("click","tr td a.on-delete",function(e){e.preventDefault();var t=this,o=$("#tb-qrcode").DataTable();swal({title:"ยืนยันการลบ",text:$(t).data("id"),type:"question",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",allowEscapeKey:!1,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(e,n){$.ajax({type:"POST",url:$(t).attr("href"),success:function(t,n,r){o.ajax.reload(),e()},error:function(e,t,o){swal({type:"error",title:o,showConfirmButton:!1,timer:1500})},dataType:"json"})})}}).then(function(e){e.value&&swal({type:"success",title:"ลบรายการเรียบร้อย!",showConfirmButton:!1,timer:1500})})}),$("#select-all").on("click",function(){var e=$("#tb-qrcode").DataTable(),t=$("button.on-delete-select-all"),o=e.rows({search:"applied"}).nodes();$('input[name="selection[]"]',o).prop("checked",this.checked);var n=e.$('input[name="selection[]"]').serialize();product.isEmpty(n)?t.prop("disabled",!0):t.prop("disabled",!1)}),$("#tb-qrcode tbody").on("change",'input[type="checkbox"]',function(){var e=$("#tb-qrcode").DataTable(),t=this.value,o=e.$('input[type="checkbox"]').serialize(),n=$("button.on-delete-select-all");if(product.isEmpty(o)||(o=o.replace(new RegExp("selection%5B%5D=","g"),""),$keys=o.split("&")),this.checked)$keys.length>0&&n.prop("disabled",!1);else{-1!==jQuery.inArray(t,$keys)&&$.each($keys,function(e,o){t===o&&$keys.splice(e,1)});var r=$("#select-all").get(0);r&&r.checked&&"indeterminate"in r&&(r.indeterminate=!0),0===$keys.length&&n.prop("disabled",!0)}}),$("#form-product .on-delete-select-all").on("click",function(){var e=this,t=[],o=$("#tb-qrcode").DataTable();o.$('input[type="checkbox"]').each(function(){this.checked&&t.push(this.value)}),t.length>0&&swal({title:"ยืนยันการลบ",text:t.length+" รายการ",type:"question",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",allowEscapeKey:!1,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(n,r){$.ajax({type:"POST",url:$(e).data("url"),data:{keys:t},success:function(e,t,r){o.ajax.reload(),$("#select-all").prop("checked",!1),n()},error:function(e,t,o){swal({type:"error",title:o,showConfirmButton:!1,timer:1500})},dataType:"json"})})}}).then(function(e){e.value&&swal({type:"success",title:"ลบรายการเรียบร้อย!",showConfirmButton:!1,timer:1500})})}),$elmqrcode_qty.keyup(function(){$(this).val()>1e3&&(swal({type:"warning",title:"Oops!",text:"สร้างได้ 1000 รหัส ต่อครั้งเท่านั้น!"}),$(this).val(1e3))});