async function initializeApp(){liff.isLoggedIn()||liff.isInClient()?(await app.getProfile(),$("body").waitMe("hide")):window.alert('To get an access token, you need to be logged in. Tap the "login" button below and try again.')}var user,account;window.onload=function(e){liff.init({liffId:"1583157145-LJYmJqrY",withLoginOnExternalBrowser:!0}).then(()=>{liff.isLoggedIn()?initializeApp():liff.login()}).catch(e=>{console.log(e),alert(JSON.stringify(e))})},axios.interceptors.request.use(function(e){return e},function(e){return Promise.reject(e)}),axios.interceptors.response.use(e=>_.get(e,"data",e),e=>Promise.reject(_.get(e,"response.data",e)));var restaurants=[],app={initLoading:function(){$("body").waitMe({effect:"roundBounce",text:"",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",waitTime:-1,textPos:"vertical",fontSize:"",source:"",onClose:function(){}})},getProfile:async function(){try{const e=liff.getIDToken(),t=await liff.getProfile();let i=await axios.get(`/v1/user/me?id_token=${e}`);user=i.user,account=i.account,localStorage.setItem("profile",JSON.stringify(t)),t.pictureUrl&&$("#picture").attr("src",t.pictureUrl),i.account?($("#sex-name").html(i.profile.sex_name),$("#fullname").html(i.profile.first_name+" "+i.profile.last_name),$("#birthday").html(i.profile.birthday),$("#tel").html(i.profile.tel),$("#province").html(i.profile.province_name),await this.getQrList(),this.scanQRCode()):window.location.replace("/site/register")}catch(e){$("body").waitMe("hide"),Swal.fire({icon:"error",title:"เกิดข้อผิดพลาด!",text:e.message}),"IdToken expired."===e.message&&(liff.logout(),window.location.reload())}},scanQRCode:async function(){try{const e=await liff.scanCodeV2(),t=yii.getQueryParams(e.value);if(!e.value)return void Swal.fire({title:"ไม่พบรหัสคิวอาร์โค้ด!",text:"",timerProgressBar:!0,allowOutsideClick:!1,showConfirmButton:!1,timer:3e3});const i=t.code;Swal.fire({title:"กรุณารอสักครู่!",text:"",timerProgressBar:!0,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),await axios.post("/v1/user/save-qrcode",{user_id:user.id,code:i}),Swal.fire({icon:"success",title:"ระบบได้ทำการบันทึกรายการของคุณแล้ว",text:"",timer:3e3,timerProgressBar:!0,allowOutsideClick:!1,showConfirmButton:!1,willClose:()=>{$("html, body").animate({scrollTop:$(document).height()},1e3)}}),app.getQrList()}catch(e){Swal.fire({icon:"warning",title:"ไม่สามารถสแกนคิวอาร์โค้ดได้!",text:e.message})}},getQrList:async function(){try{const t=await axios.get(`/v1/user/qrcode-list?userId=${user.id}`);$("#qr-total").html(t.length),$("#qr-list-item").find(".col-sm-2").remove();for(let i=0;i<t.length;i++){const o=t[i];var e=`<div class="col-sm-2"><div class="qrcode"><i class="fa fa-qrcode"></i> ${o.qrcode_id}</div></div>`;$("#qr-list-item").append(e),restaurants.push(parseFloat(o.qrcode_id))}}catch(e){Swal.fire({icon:"error",title:"เกิดข้อผิดพลาด!",text:e.message})}}};app.initLoading(),$(window).load(function(){$("html, body").animate({scrollTop:$(document).height()},1e3)});